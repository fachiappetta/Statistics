---
title: "Group Lab 1"
author: "Malkie Wall, Chrissie Pantoja, and Frankie Chiappetta"
date: "September 23, 2021"
output: rtf_document
---

## Interpretation


## Annex I: Descriptive Statistics

```{r libraries, message=FALSE, echo = FALSE, results = FALSE, warning=FALSE}
library(ggplot2) #make plots
library(dvmisc)
library(scales)
library(glue) #glue together text and variables
library(ggthemes)
library(papeR)
library(moments) #package for skewness
library(knitr) #package for making tables (kable)
library(tidyverse) #multiple packages for data wrangling
library(gt) # a package to make tables
```

```{r, echo = FALSE, results = FALSE, message=FALSE}
#read in dataframe and look at it
fracking_df = read.csv("PAFracking.csv")
glimpse(fracking_df)
```


#### *Methane levels near fracking sites vs. Methane levels far from fracking sites for ALL observations*

```{r ALL summary , echo = FALSE, results=FALSE, message=FALSE}
#MALKIE - ALL summary 
summary_fracking <- fracking_df %>% 
  dplyr::group_by(proximity) %>%
  select(methane) %>%
  dplyr::summarize(
                    length_methane=length(methane),
                    median_methane=median(methane),
                    mean_methane=mean(methane),
                    min_methane=min(methane),
                    max_methane=max(methane),
                    sd_methane=sd(methane),
                    skew_methane=skewness(methane),
                    ) 

glimpse(summary_fracking)
```

```{r ALL summary gt, echo = FALSE, warning=FALSE}
#MALKIE - ALL summary gt
summary_fracking %>%
gt() %>%
  
  tab_options(
    table.width = pct(80)
  )%>%
  
  cols_width(
    vars(length_methane)~ px(100),
    everything() ~ px(80))%>%
  
  tab_header(
    title = md("Table 1. Summary Statistics of Methane Levels, By Proximity to Fracking Wells"),
    subtitle = md("ug/L methane in well water")) %>%
  
  fmt_passthrough (columns=c(proximity)) %>%
  fmt_number(columns = c(length_methane), decimals = 0) %>%
  fmt_number(columns = c(median_methane), decimals = 3) %>%
  fmt_number(columns = c(mean_methane), decimals=1) %>%
  fmt_number(columns = c(min_methane), decimals = 4) %>%
  fmt_number(columns = c(max_methane), decimals = 0) %>%
  fmt_number(columns = c(sd_methane), decimals = 0) %>%
  fmt_number(columns = c(skew_methane), decimals = 3) %>%

cols_label(
    length_methane = "Observations",
    median_methane = "Median",
    mean_methane = "Mean",
    min_methane = "Minimum",
    max_methane = "Maximum",
    sd_methane = "SD",
    skew_methane = "Skewness")
```


```{r ALL histogram original data, echo = FALSE, fig.height=5, fig.width=7}
#MALKIE - ALL histogram of original data
p<-ggplot(fracking_df, aes(x=methane, fill=proximity))+
geom_histogram(col="black", bins = 15)+
scale_fill_manual(values=c("royalblue", "gray"))

p + facet_grid(proximity ~ .)+
labs(x="Methane concentrations in ug/L", title="Figure 1. Methane Levels in Well Water for Sites Near Fracking Wells (n=322) \nand Far from Fracking Wells (n=1,379) in Pennsylvania",
     fill="Proximity to Well") + theme(plot.title = element_text(size = 12))
```



#### *Methane levels near fracking sites vs. Methane levels far from fracking sites for valley observations*

```{r VALLEY filter, echo = FALSE, results = FALSE}
#VALLEY filter data
valley_fracking <- fracking_df %>% dplyr::filter(location == "Valley")
head(valley_fracking)
```

```{r VALLEY summary, echo = FALSE, results = FALSE, message=FALSE, warning=FALSE}
#VALLEY: summary table

summary_valley_fracking <-valley_fracking %>% 
  dplyr::group_by(proximity) %>%
  select(methane) %>%
  dplyr::summarize(
                    length.methane=length(methane),
                    mean.methane=mean(methane),
                    median.methane=median(methane),
                    min.methane=min(methane),
                    max.methane=max(methane),
                    sd.methane=sd(methane),
                    skew.methane=skewness(methane),
                    )

summary_valley_fracking
```

```{r gt summary table, echo = FALSE}
#VALLEY: make gt summary box
summary_valley_fracking %>%
gt() %>%
  tab_header(
    title = md("Table 2. Summary Statistics of Methane Levels for Far and Near Valley Sites"),
    subtitle = "Methane measured in ug/L") %>%
  
 
  fmt_passthrough (columns=c(proximity)) %>%
  fmt_number(columns = c(length.methane), decimals = 0) %>%
  fmt_number(columns = c(mean.methane), decimals=0) %>%
  fmt_number(columns = c(median.methane), decimals = 2) %>%
  fmt_number(columns = c(min.methane), decimals = 4) %>%
  fmt_number(columns = c(max.methane), decimals = 0) %>%
  fmt_number(columns = c(sd.methane), decimals = 0) %>%
  fmt_number(columns = c(skew.methane), decimals = 3) %>%

cols_label(
    proximity="proximity",
    length.methane = "Observations",
    mean.methane = "Mean",
    median.methane = "Median",
    min.methane = "Minimum",
    max.methane = "Maximum",
    sd.methane = "SD",
    skew.methane = "Skewness")
  
```


```{r histograms original, echo = FALSE, fig.height=5, fig.width=7}
#VALLEY
p<-ggplot(valley_fracking, aes(x=methane, fill=proximity))+
geom_histogram(col="black", bins = 15)+
scale_fill_manual(values=c("royalblue", "gray"))

p + facet_grid(proximity ~ .)+
labs(x="Methane concentrations in ug/L", title="Figure 2. Methane levels in ug/L in Well Water for Valley Sites Near Fracking \nWells (n=195) and Far from Fracking Wells (n=670) in Pennsylvania",
     fill="Proximity") + theme(plot.title = element_text(size = 12))


```

#### *Methane levels near fracking sites vs. Methane levels far from fracking sites for upland observations*



```{r filter upland,echo = FALSE, results = FALSE}
#filter the data for upland
upland_fracking.df<-fracking_df %>%
                      filter(proximity=="Near"|
					            proximity=="Far") %>%
                      filter(location=="Upland")
head(upland_fracking.df)

```


```{r summarytable upland, echo = FALSE, results = FALSE, message=FALSE}

#summary for upland
summary_upland_fracking.df <-upland_fracking.df %>% 
  dplyr::group_by(proximity) %>%
  select(methane) %>%
  dplyr::summarize(
                    length.methane=length(methane),
                    mean.methane=mean(methane),
                    median.methane=median(methane),
                    min.methane=min(methane),
                    max.methane=max(methane),
                    sd.methane=sd(methane),
                    skew.methane=skewness(methane),
                    )

glimpse(summary_upland_fracking.df)

```

```{r summary upland gt, echo = FALSE, message=FALSE}
#summary for upland fracking
summary_upland_fracking.df %>%
gt() %>%
  tab_header(
    title = md("Table 3. Summary Statistics of Methane Levels in Near and Far Upland"),
    subtitle = "methane measured in ug/L") %>%
  
  fmt_passthrough (columns=c(proximity)) %>%
  fmt_number(columns = c(length.methane), decimals = 0) %>%
  fmt_number(columns = c(mean.methane), decimals=1) %>%
  fmt_number(columns = c(median.methane), decimals = 3) %>%
  fmt_number(columns = c(min.methane), decimals = 4) %>%
  fmt_number(columns = c(max.methane), decimals = 0) %>%
  fmt_number(columns = c(sd.methane), decimals = 0) %>%
  fmt_number(columns = c(skew.methane), decimals = 2) %>%

cols_label(
    proximity="Proximity",
    length.methane = "Observations",
    mean.methane = "Mean",
    median.methane = "Median",
    min.methane = "Minimum",
    max.methane = "Maximum",
    sd.methane = "SD",
    skew.methane = "Skewness"  )
  
```

```{r histogram upland original data, echo = FALSE, fig.height=5, fig.width=7}
#UPLAND
histo<-ggplot(upland_fracking.df, aes(x=log(methane), fill=proximity))+
geom_histogram(col="black", bins = 15)+
scale_fill_manual(values=c("royalblue", "gray"))

histo + facet_grid(proximity ~ .)+
labs(x="Methane concentration in ug/L", title="Figure 3. Methane levels in ug/L in Well Water for Valley Sites Near \nFracking Wells (n=127) and Far from Fracking Wells (n=709) in Pennsylvania",
     fill="Proximity to Well")+ theme(plot.title = element_text(size = 12))
```

#### *Methane levels in the valley vs. Methane levels in the upland*

```{r upland & valley summary, echo= FALSE, message=FALSE, results=FALSE}
#upland & valley:summary
summary_valley_upland_fracking <-fracking_df %>% 
  dplyr::group_by(location) %>%
  select(methane) %>%
  dplyr::summarize(
                    length.methane=length(methane),
                    mean.methane=mean(methane),
                    median.methane=median(methane),
                    min.methane=min(methane),
                    max.methane=max(methane),
                    sd.methane=sd(methane),
                    skew.methane=skewness(methane),
                    )

summary_valley_fracking
```


```{r upland & valley summary gt, echo=FALSE}
#upland & valley: make gt summary box
summary_valley_upland_fracking %>%
gt() %>%
  tab_header(
    title = md("Table 4. Summary Statistics of Methane Levels for Upland and Valley Sites"),
    subtitle = "Methane measured in ug/L") %>%
  
 
  fmt_passthrough (columns=c(location)) %>%
  fmt_number(columns = c(length.methane), decimals = 0) %>%
  fmt_number(columns = c(mean.methane), decimals=0) %>%
  fmt_number(columns = c(median.methane), decimals = 3) %>%
  fmt_number(columns = c(min.methane), decimals = 4) %>%
  fmt_number(columns = c(max.methane), decimals = 0) %>%
  fmt_number(columns = c(sd.methane), decimals = 0) %>%
  fmt_number(columns = c(skew.methane), decimals = 2) %>%

cols_label(
    location="location",
    length.methane = "Observations",
    mean.methane = "Mean",
    median.methane = "Median",
      min.methane = "Minimum",
    max.methane = "Maximum",
    sd.methane = "SD",
    skew.methane = "Skewness")
  
```




```{r  upland & valley histograms original, echo = FALSE, fig.height=5, fig.width=7}
#upland & valley: histogram
p<-ggplot(valley_fracking, aes(x=(methane), fill=proximity))+
geom_histogram(col="black", bins =15)+
scale_fill_manual(values=c("royalblue", "gray"))

p + facet_grid(proximity ~ .)+
labs(x="Methane concentrations in ug/L", title="Figure 4. Methane levels in ug/L in Well Water in Upland Sites (n=836) \nand in Valley Sites (n=865) in Pennsylvania",
     fill="Proximity to Wells") + theme(plot.title = element_text(size = 12))


```



## Annex 2: Comparison of Means Tests

#### *Methane levels near fracking sites vs. Methane levels far from fracking sites for ALL observations*

*Welch's t-test on original data*
```{r ttest original ALL, echo=FALSE}
#Assumes mean(Far)-mean(Near). Far has lower mean methane levels than Near, so the difference (and the confidence intervals) is in the negative range. 
#NEED TO CHECK THAT THIS INTUTION IS RIGHT.

t.test(methane ~ proximity, fracking_df, alternative= "less")
```

*Test for normality on original data*
```{r, echo=FALSE, results = FALSE}
#Creates new data table for proximity=Near
near_fracking_df <- fracking_df %>% filter(proximity == "Near")%>%
   glimpse()

#Creates new data table for proximity=Far
far_fracking_df <- fracking_df %>% filter(proximity == "Far")%>%
   glimpse()
```

```{r, echo=FALSE}
#Run Shapiro on Near
near_fracking_df<-fracking_df %>%
  filter(proximity =="Near")

shapiro.test(near_fracking_df$methane)

#Run Shapiro on Far
far_fracking_df<-fracking_df %>%
  filter(proximity =="Far")

shapiro.test(far_fracking_df$methane)
```

*Histogram on logged data*
```{r, echo=FALSE, messgaes = FALSE, fig.height=5, fig.width=7}
#Create a new variable of logged methane levels called log_methane and add to dataframe fracking_df
fracking_df$log_methane<-log(fracking_df$methane)
head(fracking_df)

#Make histogram of logged data
p<-ggplot(fracking_df, aes(x=log_methane, fill=proximity))+
geom_histogram(col="black", bins = 15)+
scale_fill_manual(values=c("royalblue", "gray"))

p + facet_grid(proximity ~ .)+
labs(x="Logged methane concentrations in ug/L", title="Figure 5. Logged methane Levels in Well Water for Sites Near Fracking Wells (n=322) \nand Far from Fracking Wells (n=1,379) in Pennsylvania",
     fill="Proximity to Well") + theme(plot.title = element_text(size = 12))

```

*Boxplot on logged data *
```{r log boxplot for all sites, echo= FALSE, fig.height=5, fig.width=7}
##VALLEY: make boxplot
p <-ggplot(fracking_df, aes(x=log_methane, fill=proximity))+
geom_boxplot(col="black")+
scale_fill_manual(values=c("royalblue", "gray"))
p + labs(x="Logged methane concentrations in ug/L", title="Figure 6. Logged methane Levels in Well Water for Sites Near Fracking Wells (n=322) \nand Far from Fracking Wells (n=1,379) in Pennsylvania",
     fill="Proximity to Well") + theme(plot.title = element_text(size = 12))

```

*Shapiro-Wilk test on logged data*
```{r, echo = FALSE, results = FALSE}
#Check that Near and Far data frames have logged methane variable
near_fracking_df<-fracking_df %>%
  filter(proximity =="Near")
head (near_fracking_df)

far_fracking_df<-fracking_df %>%
  filter(proximity =="Far")
head (far_fracking_df)

```

```{r, echo= FALSE}
#Run Shapiro on Near_logged
shapiro.test(near_fracking_df$log_methane)

#Run Shapiro on Far_logged
shapiro.test(far_fracking_df$log_methane)
```

*Welch's t-test on logged data*
```{r, echo= FALSE}
#Assumes mean(Far)-mean(Near). Far has lower mean methane levels than Near, so the difference (and the confidence intervals) is in the negative range. 
#CONFIRM THAT THIS ASSUMPTION IS CORRECT.

log_ttest_all <- t.test(log_methane ~ proximity, fracking_df, alternative="less")
log_ttest_all
```

*Multiplicative factor of the median*
```{r, echo = FALSE, results=FALSE}
str(t.test(log_methane ~ proximity, fracking_df, alternative="less"))
logged_mean_far_fracking <- t.test(log_methane ~ proximity, data=fracking_df)$estimate[1]
logged_mean_near_fracking <- t.test(log_methane ~ proximity, data=fracking_df)$estimate[2]
```

```{r, echo = FALSE, results = FALSE}
#means
logged_mean_far_fracking
logged_mean_near_fracking
```

```{r, echo = FALSE}
#Again, mean(Far) - mean (Near)
#Exponentiate difference of log data to get multiplicative factor of the medians.

exp_mean_diff<- exp(logged_mean_far_fracking - logged_mean_near_fracking)
glue("The multiplicative factor of the medians for all sites (far - near) is {round(exp_mean_diff,4)} ug/L")
```

*Confidence interval the logged data*
```{r, echo = FALSE}
#Now, we also need to back transform the confidence interval and that becomes the confidence interval for the multiplicative factor of the medians! 

#THESE ARE THE NUMBERS FROM THE TUTORIAL.  MY OUTPUT SAYS -Inf -0.6091616. WHAT DO I MAKE OF THAT?
#95 percent confidence interval:
       #-Inf -0.6091616

lower.exp<-exp(log_ttest_all$conf.int[1])
upper.exp<-exp(log_ttest_all$conf.int[2])

glue("The confidence interval for all sites for far and near is {lower.exp} to {round(upper.exp,4)} ug/L")


#The 95% confidence interval for the multiplicative factor of the medians is (lower.exp, upper.exp). We are 95% confidence that this interval includes the true multiplicative factor of the medians!
```

*Non-parametric test = Wilcox test*
```{r, echo = FALSE}
wilcox.test(methane ~ proximity, data = fracking_df, alternative = "less")

```


####  *Methane levels near fracking sites vs. Methane levels far from fracking sites for valley observations*

*Welch's t-test on original data*
```{r original data ttest, echo= FALSE}
##VALLEY: Welch t test for original data
ttest_original_valley <- t.test(methane ~ proximity, valley_fracking, alternative= "less")
ttest_original_valley
```



*Test for normality on original data*
```{r sw.far.original, echo = FALSE}
##VALLEY: Shapiro Wilk test for original data of valley sites: far 
valley_fracking_far <-valley_fracking %>%
  filter(proximity =="Far")


shapiro.test(valley_fracking_far$methane)
```

```{r sw.near.original, echo = FALSE}
##VALLEY: Shapiro Wilk test for original data of valley sites: near
valley_fracking_near <-valley_fracking %>%
  filter(proximity =="Near")


shapiro.test(valley_fracking_near$methane)
```

```{r log, echo = FALSE, results = FALSE}
#VALLEY: save new column as log methane
valley_fracking$log_methane <- log(valley_fracking$methane)
head(valley_fracking)
```

*Histogram on logged data *
```{r histograms logged valley, echo = FALSE, fig.height=5, fig.width=7}
#VALLEY
p<-ggplot(valley_fracking, aes(x=log_methane, fill=proximity))+
geom_histogram(col="black", bins = 15)+
scale_fill_manual(values=c("royalblue", "gray"))

p + facet_grid(proximity ~ .)+
labs(x="Logged methane concentrations in ug/L", title="Figure 7. Logged methane levels in ug/L in Well Water for Valley Sites Near \nFracking Wells (n=195) and Far from Fracking Wells (n=670) in Pennsylvania",
     fill="Proximity") + theme(plot.title = element_text(size = 12))


```

*Boxplot on logged data *
```{r log boxplot, echo = FALSE, fig.height=5, fig.width=7}
##VALLEY: make boxplot
p <-ggplot(valley_fracking, aes(x=log(methane), fill=proximity))+
geom_boxplot(col="black")+
scale_fill_manual(values=c("royalblue", "gray"))
p + labs(x="Logged methane concentrations in ug/L", title="Figure 8. Logged methane levels in ug/L in Well Water for Valley Sites Near \nFracking Wells (n=195) and Far from Fracking Wells (n=670) in Pennsylvania",
     fill="Proximity to Well")+ theme(plot.title = element_text(size = 12))

```


*Shapiro-Wilk test on logged data*
```{r sw.far.log, echo = FALSE}
#VALLEY: Shapiro Wilk test for logged data of valley sites: far 
valley_fracking_far <-valley_fracking %>%
  filter(proximity =="Far")


shapiro.test(valley_fracking_far$log_methane)
```

```{r sw.near.log, echo=FALSE}
#VALLEY: Shapiro Wilk test for logged data of valley sites: near 
valley_fracking_near <-valley_fracking %>% filter(proximity =="Near")

shapiro.test(valley_fracking_near$log_methane)
```

*Welch's t-test on logged data*
```{r log ttest, echo=FALSE}
#VALLEY: Welch t test for logged data
log_ttest_valley <- t.test(log_methane ~ proximity, valley_fracking, alternative= "less")
log_ttest_valley
```

*Confidence interval for the logged data*
```{r valley CI, echo = FALSE}
#CONFIDENCE INTERVAL
CI_lower_valley <- exp(log_ttest_valley$conf.int[1])
CI_upper_valley <- exp(log_ttest_valley$conf.int[2])


glue("The confidence interval for valley sites for far and near is {CI_lower_valley} to {round(CI_upper_valley,4)} ug/L")
```

*multiplicative factor of the medians*
```{r, echo = FALSE}
exp_mean_diff <- exp(log_ttest_valley$estimate[1] - log_ttest_valley$estimate[2])
glue("The multiplicative factor of the medians for valley sites (far - near) is {round(exp_mean_diff,4)} ug/L")

```


*Non-parametric test = Wilcox test*
```{r, echo = FALSE}
#VALLEY: wilcox test, non parametric
wilcox_valley_fracking <- wilcox.test(methane ~ proximity, data = valley_fracking, alternative = "less")
wilcox_valley_fracking
```

#### *Methane levels near fracking sites vs. Methane levels far from fracking sites for upland observations*

*Welch's t-test on original data*

```{r t.test, echo = FALSE}

t.test(methane ~ proximity, upland_fracking.df, alternative = "less")

```


*Test for normality on original data*


```{r near upland.df.sw, echo = FALSE}

upland_fracking_near.df<-upland_fracking.df %>%
  filter(proximity=="Near") 

shapiro.test(upland_fracking_near.df$methane)

```

```{r far upland.df.ca, echo=FALSE}
upland_fracking_far.df<-upland_fracking.df %>%
  filter(proximity=="Far")

shapiro.test(upland_fracking_far.df$methane)

```

*Histogram on logged data *

```{r, echo=FALSE, results=FALSE}
#created logged data
upland_fracking.df$log.methane<-log(upland_fracking.df$methane)
head(upland_fracking.df)
```

```{r histogram upland logged data, echo = FALSE, fig.height=5, fig.width=7}
#upland
histo<-ggplot(upland_fracking.df, aes(x=log.methane, fill=proximity))+
geom_histogram(col="black", bins = 15)+
scale_fill_manual(values=c("royalblue", "gray"))

histo + facet_grid(proximity ~ .)+
labs(x="Logged methane concentration in ug/L", title="Figure 9. Logged methane levels in ug/L in Well Water for Upland Sites Near Fracking \nWells (n=127) and Far from Fracking Wells (n=709) in Pennsylvania",
     fill="Proximity to Well")+ theme(plot.title = element_text(size = 12))
```
*Boxplot on logged data*
```{r log boxplot upland, echo = FALSE, fig.height=5, fig.width=7}
##Upland: make boxplot
p <-ggplot(upland_fracking.df, aes(x=log.methane, fill=proximity))+
geom_boxplot(col="black")+
scale_fill_manual(values=c("royalblue", "gray"))
p + labs(x="Logged methane concentrations, ug/L", title="Figure 10. Logged methane levels in ug/L in Well Water for Upland Sites Near Fracking \nWells (n=127) and Far from Fracking Wells (n=709) in Pennsylvania",
     fill="Proximity to Well")+ theme(plot.title = element_text(size = 12))

```


*Shapiro-Wilk test on logged data*

```{r upland sw.far.log, echo = FALSE}
#Upland: Shapiro Wilk test for logged data of valley sites: far 
upland_fracking_far.df <-upland_fracking.df %>%
  filter(proximity =="Far")


shapiro.test(upland_fracking_far.df$log.methane)
```

```{r upland sw.near.log, echo=FALSE}
#Upland: Shapiro Wilk test for logged data of valley sites: near 
upland_fracking_near.df <- upland_fracking.df %>% filter(proximity =="Near")

shapiro.test(upland_fracking_near.df$log.methane)
```

*Welch's t-test on logged data*

```{r, echo = FALSE, echo=FALSE}
log_test_upland <- t.test(log.methane ~ proximity, upland_fracking.df, alternative="less")
log_test_upland
```



*Confidence interval for the logged data*
```{r upland logged CI, echo = FALSE}
#CONFIDENCE INTERVAL
CI_lower_upland <- exp(log_test_upland$conf.int[1])
CI_upper_upland <- exp(log_test_upland$conf.int[2])

glue("The confidence interval for upland sites for far and near is {CI_lower_upland} {round(CI_upper_upland,4)} ug/L")

```

*difference in multiplicative factor of medians*
```{r, echo = FALSE}
exp_mean_diff <- exp(log_test_upland$estimate[1] - log_test_upland$estimate[2])
glue("The multiplicative factor of the medians for valley sites (far - near) is {round(exp_mean_diff,4)} ug/L")
```


*Non-parametric test = Wilcox test*
```{r, echo =  FALSE}
#Upland: wilcox test, non parametric
wilcox_upland_fracking <- wilcox.test(methane ~ proximity, data = upland_fracking.df, alternative = "less")
wilcox_upland_fracking

```



#### *Methane levels in the valley vs. Methane levels in the upland*

*Welch's t-test on original data*
```{r upland & valley original data ttest, echo = FALSE}
#upland & valley: Welch t test for original data
ttest_original_valley_upland <- t.test(methane ~ location, fracking_df)
ttest_original_valley_upland
```

*Test for normality on original data*
```{r upland & valley create upland & valley, echo = FALSE}
#Creates new data table for location is valley
valley_fracking_df <- fracking_df %>% filter(location == "Valley")

#Creates new data table for location is valley
upland_fracking_df <- fracking_df %>% filter(location == "Upland")
```

```{r upland & valley sw, echo = FALSE}
#Run Shapiro on Valley
upland_fracking_df<-fracking_df %>%
  filter(location =="Upland")

shapiro.test(upland_fracking_df$methane)

#Run Shapiro on Upland
valley_fracking_df<-fracking_df %>%
  filter(location =="Valley")

shapiro.test(valley_fracking_df$methane)
```

*Histogram on logged data*
```{r upland & valley histograms logged, echo = FALSE, message=FALSE, fig.height=5, fig.width=7}

#VALLEY: histogram on logged data
p<-ggplot(fracking_df, aes(x=log_methane, fill=location))+
geom_histogram(col="black", bins = 15)+
scale_fill_manual(values=c("royalblue", "gray"))

p + facet_grid(location ~ .)+
labs(x="Figure 11. Logged methane concentration in ug/L", title="Logged methane levels in ug/L in Well Water for All Sites Near Fracking \nWells (n=127) and Far from Fracking Wells (n=709) in Pennsylvania",
     fill="Proximity to Well")+ theme(plot.title = element_text(size = 12))



```



*Boxplot on logged data*

```{r upland & valley log boxplot, echo = FALSE, fig.height=5, fig.width=7}
#upland & valley: make boxplot
p <-ggplot(fracking_df, aes(x=log_methane, fill=location))+
geom_boxplot(col="black")+
scale_fill_manual(values=c("royalblue", "gray"))
p + labs(x="Figure 12. Logged methane concentrations, ug/L", title="Logged methane levels in ug/L in Well Water for Upland Sites Near Fracking Wells (n=127) \nand Far from Fracking Wells (n=709) in Pennsylvania",
     fill="Proximity to Well")+ theme(plot.title = element_text(size = 12))
```

*Shapiro-Wilk test on logged data*
```{r upland & valley logged sw for upland, echo = FALSE}
#upland & valley: Shapiro Wilk test for logged data of upland sites 
shapiro.test(upland_fracking_df$log_methane)
```

```{r upland & valley logged sw for valley, echo = FALSE}
#upland & valley: Shapiro Wilk test for logged data of valley sites 
shapiro.test(valley_fracking_df$log_methane)
```

*Welch's t-test on logged data*
```{r upland & valley log ttest, echo = FALSE}
#upland and valley: Welch t test for logged data
log_ttest_valley_upland <- t.test(log_methane ~ location, fracking_df)
log_ttest_valley_upland
```

*Confidence Interval on logged data*
```{r upland & valley logged summary statistics, echo = FALSE}
#CONFIDENCE INTERVAL
CI_lower_valley_upland <- exp(log_ttest_valley_upland$conf.int[1])

CI_upper_valley_upland <- exp(log_ttest_valley_upland$conf.int[2])

glue("The confidence interval for all sites for upland and valley is{round(CI_lower_valley_upland,4)} to {round(CI_upper_valley_upland,4)} ug/L")

```

*multiplicative factor of the medians*
```{r, echo = FALSE}
exp_mean_diff<- exp(log_ttest_valley_upland$estimate[1] - log_ttest_valley_upland$estimate[2])
glue("The multiplicative factor of the medians for all sites (upland - valley) is {round(exp_mean_diff,4)} ug/L")
```


*Non-parametric test = Wilcox test*
```{r upland & valley wilcox, echo = FALSE}
#VALLEY: wilcox test, non parametric
wilcox_valley_fracking <- wilcox.test(methane ~ location, data = fracking_df, alternative = "less")
wilcox_valley_fracking
```






## Annex 3: Censored data
```{r, echo = FALSE, message=FALSE, warning=FALSE}
#Create summary table for ALL
censored_df <- fracking_df %>% 
  dplyr::group_by(dl) %>%
  select(methane) %>%
  dplyr::summarize(
      length_methane=length(methane),
      median_methane=median(methane),
      min_methane=min(methane),
      max_methane=max(methane),
      mean_methane=mean(methane),
      )
```

```{r, echo= FALSE, message=FALSE, warning=FALSE}
#Create summary table for Near CENSORED
censored_near_df <- fracking_df %>% 
  filter(proximity == "Near") %>%
  dplyr::group_by(dl) %>%
  select(methane) %>%
  dplyr::summarize(
      length_methane=length(methane),
      median_methane=median(methane),
      min_methane=min(methane),
      max_methane=max(methane),
      mean_methane=mean(methane),
      )
```

```{r, echo= FALSE, message=FALSE, warning=FALSE}
#Create summary table for Far CENSORED
censored_far_df <- fracking_df %>% 
  filter(proximity == "Far") %>%
  dplyr::group_by(dl) %>%
  select(methane) %>%
  dplyr::summarize(
      length_methane=length(methane),
      median_methane=median(methane),
      min_methane=min(methane),
      max_methane=max(methane),
      mean_methane=mean(methane),
      )
```

```{r, echo = FALSE, message=FALSE, warning=FALSE}
#gt summary table for ALL CENSORED
censored_df %>%
gt() %>%
  
  tab_options(
    table.width = pct(80)
  )%>%
  
  cols_width(
    vars(length_methane)~ px(100),
    everything() ~ px(80))%>%
  
  tab_header(
    title = md("Table 5. Summary Statistics of Methane Levels for Uncensored (dl = 0) and Censored (dl = 1) Data"),
    subtitle = md("ug/L methane in well water")) %>%
  
  fmt_passthrough (columns=c(dl)) %>%
  fmt_number(columns = c(length_methane), decimals = 0) %>%
  fmt_number(columns = c(median_methane), decimals = 3) %>%
  fmt_number(columns = c(mean_methane), decimals=1) %>%
  fmt_number(columns = c(min_methane), decimals = 4) %>%
  fmt_number(columns = c(max_methane), decimals = 0) %>%

cols_label(
    length_methane = "Observations",
    median_methane = "Median",
    mean_methane = "Mean",
    min_methane = "Minimum",
    max_methane = "Maximum")
```

```{r, echo = FALSE, message=FALSE, warning=FALSE}
#gt summary table for: CENSORED NEAR
censored_near_df %>%
gt() %>%
  
  tab_options(
    table.width = pct(80)
  )%>%
  
  cols_width(
    vars(length_methane)~ px(100),
    everything() ~ px(80))%>%
  
  tab_header(
    title = md("Table 6. Summary Statistics of Methane Levels for Uncensored (dl = 0) and Censored (dl = 1) Data Near Fracking Sites "),
    subtitle = md("ug/L methane in well water")) %>%
  
  fmt_passthrough (columns=c(dl)) %>%
  fmt_number(columns = c(length_methane), decimals = 0) %>%
  fmt_number(columns = c(median_methane), decimals = 3) %>%
  fmt_number(columns = c(mean_methane), decimals=1) %>%
  fmt_number(columns = c(min_methane), decimals = 4) %>%
  fmt_number(columns = c(max_methane), decimals = 0) %>%

cols_label(
    length_methane = "Observations",
    median_methane = "Median",
    mean_methane = "Mean",
    min_methane = "Minimum",
    max_methane = "Maximum")
```

```{r, echo = FALSE, message=FALSE, warning=FALSE}
#gt summary table for: CENSORED FAR
censored_far_df %>%
gt() %>%
  
  tab_options(
    table.width = pct(80)
  )%>%
  
  cols_width(
    vars(length_methane)~ px(100),
    everything() ~ px(80))%>%
  
  tab_header(
    title = md("Table 7. Summary Statistics of Methane Levels for Uncensored (dl = 0) and Censored (dl = 1) Data Near Fracking Sites Far From Fracking Sites "),
    subtitle = md("ug/L methane in well water")) %>%
  
  fmt_passthrough (columns=c(dl)) %>%
  fmt_number(columns = c(length_methane), decimals = 0) %>%
  fmt_number(columns = c(median_methane), decimals = 3) %>%
  fmt_number(columns = c(mean_methane), decimals=1) %>%
  fmt_number(columns = c(min_methane), decimals = 4) %>%
  fmt_number(columns = c(max_methane), decimals = 0) %>%

cols_label(
    length_methane = "Observations",
    median_methane = "Median",
    mean_methane = "Mean",
    min_methane = "Minimum",
    max_methane = "Maximum")
```

```{r, echo = FALSE, results = FALSE, message=FALSE, warning=FALSE}
#Create new data frame of only censored values
censored_df1 <- fracking_df %>% filter(dl > 0)
censored_df1
```

```{r histograms censored, echo = FALSE, fig.height=5, fig.width=7}
#Histogram of censored data

p<-ggplot(censored_df1, aes(x=methane, fill=proximity))+
geom_histogram(col="black", bins = 15)+
scale_fill_manual(values=c("royalblue", "gray"))

p + facet_grid(proximity ~ .)+
labs(x="Methane concentrations in ug/L", title="Figure 13. Methane Levels of Censored Observations (dl = 1) in Well Water for Sites \nNear Fracking Wells (n=322) and Far from Fracking Wells (n=1,379) in Pennsylvania",
     fill="Proximity to Well") + theme(plot.title = element_text(size = 12))
```








